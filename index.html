<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì„¸ê³„ ê¸°ì¥ì„ êµì‚¬ íŒŒì†¡ ì§€ë„</title>
  <!-- Leaflet ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin: 0; font-family: sans-serif; }
    h1 { text-align: center; padding: 10px; }

    /* ğŸ“Œ ì§€ë„ ì „ì²´ í¬ê¸° ì„¤ì •: ë†’ì´ëŠ” í™”ë©´ ë†’ì´ì˜ 80%, ë„ˆë¹„ëŠ” ì „ì²´ í™”ë©´ ë„ˆë¹„ë¡œ ì§€ì • */
    #map { height: 40vh; width: 100vw; }

    /* ìƒì„¸ íŒì—…ì°½ ìŠ¤íƒ€ì¼ */
    .detail-popup {
      position: fixed;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 999;
      display: none;
      width: 300px;
    }
    .detail-popup h3 { margin-top: 0; }
    .detail-popup img { width: 100%; border-radius: 8px; margin-bottom: 10px; }
    .close-btn {
      float: right;
      cursor: pointer;
      color: red;
      font-weight: bold;
    }
    .flag-icon { width: 20px; height: 15px; vertical-align: middle; margin-right: 5px; }
    .popup-list:hover { cursor: pointer; color: blue; text-decoration: underline; }
  </style>
</head>
<body>
  <h1>ì„¸ê³„ ê¸°ì¥ì„ êµì‚¬ íŒŒì†¡ ì§€ë„</h1>
  <div id="map"></div>
  <div id="detailPopup" class="detail-popup"></div>

  <!-- Leaflet ìŠ¤í¬ë¦½íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ISO 2-letter êµ­ê°€ ì½”ë“œì— ëŒ€ì‘í•˜ëŠ” êµ­ê¸° URL ì½”ë“œ ë§¤í•‘
    const countryFlags = {
      "ì¼ë³¸": "jp", "ì¤‘êµ­": "cn", "ëŒ€ë§Œ": "tw", "ëª½ê³¨": "mn", "í•„ë¦¬í•€": "ph",
      "ë¯¸ì–€ë§ˆ": "mm", "íƒœêµ­": "th", "ìº„ë³´ë””ì•„": "kh", "ë„¤íŒ”": "np", "ë¼ì˜¤ìŠ¤": "la",
      "ì¸ë„": "in", "ì¸ë„ë„¤ì‹œì•„": "id", "íŒŒí‚¤ìŠ¤íƒ„": "pk", "ë™í‹°ëª¨ë¥´": "tl", "ë§ë ˆì´ì‹œì•„": "my",
      "ë‰´ì§ˆëœë“œ": "nz", "í˜¸ì£¼": "au", "ì´ìŠ¤ë¼ì—˜": "il", "ë…ì¼": "de", "í—ê°€ë¦¬": "hu",
      "ë¶ˆê°€ë¦¬ì•„": "bg", "ë¶€ë¥´í‚¤ë‚˜íŒŒì†Œ": "bf", "ì¼€ëƒ": "ke", "ëª¨ë¦¬íƒ€ë‹ˆ": "mr",
      "ë¯¸êµ­": "us", "ì¿ ë°”": "cu"
    };

    // ì§€ë„ ê°ì²´ ìƒì„± ë° ì´ˆê¸° ìœ„ì¹˜ ì„¤ì • (ì„¸ê³„ ì¤‘ì‹¬ ì¢Œí‘œ)
    const map = L.map('map').setView([20, 0], 2);
    // íƒ€ì¼ ë ˆì´ì–´ ì¶”ê°€ (ì˜¤í”ˆìŠ¤íŠ¸ë¦¬íŠ¸ë§µ)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // ì„ êµì‚¬ ë°ì´í„° (êµ­ê°€ë³„ ì´ë¦„ ë°°ì—´)
    const missionaryData = {
      "ì¼ë³¸": ["ê°€ì •ìˆœ", "ê¹€ì¢…í˜„", "ì •ì§€ì˜", "ì‹ ìš©ì„­", "ê¹€ì„±ì–¸", "ì˜¤ì€ì„±"],
      "ì¤‘êµ­": ["ì–‘OO"], "ëŒ€ë§Œ": ["ê¹€ê¸°íƒœ", "ì´ê°•ì„", "ì¡°í•˜ì˜", "ë°•ê·¼ì˜"],
      "ëª½ê³¨": ["ê¹€ìƒí—Œ"], "í•„ë¦¬í•€": ["ì´ì„±ìˆ˜", "ê¹€í˜„ìˆ™", "ê¸ˆì„ì¸", "ê°•ê²½ì§„", "ë°©íƒœí™”", "ê¹€ì˜ê¶Œ"],
      "ë¯¸ì–€ë§ˆ": ["ê¹€ê²½í™˜"], "íƒœêµ­": ["ê¹€ì™„ì£¼", "ê¹€ê¸°ì„±", "ì´ì¬ê´‘", "ëª…ìŠ¹ì¸", "ë°•ì¤€ìˆ˜"],
      "ìº„ë³´ë””ì•„": ["ê¹€í˜•ê¸°", "ê¹€ê´€ì‹", "ì´ë¯¼ì¼", "í™©í•˜ì–€", "í™©í¬ëª…", "ê¹€ê²½í¬", "ì§„ì¬ì€"],
      "ë„¤íŒ”": ["ìµœì–‘ì„", "ìœ¤ì¢…ìˆ˜", "í—ˆí˜„", "ì´ìˆ˜ì—´", "ê¹€ì¢…ì°¬"],
      "ë¼ì˜¤ìŠ¤": ["ì°¨ëª…ë ¬", "ì •ë³‘ê¶Œ"], "ì¸ë„": ["ê¹€ê¸ˆì• ", "ì´ì˜¥í¬", "ì •í˜¸ì§„", "ê¹€ê²½ë¯¸", "ì´í™”ë‘", "ì´ë„í˜•"],
      "ì¸ë„ë„¤ì‹œì•„": ["ê¹€ê´‘í›ˆ", "ê¶Œë™ìš©", "ì„¤ë‚˜ë¼", "ë°•ì¤€í˜¸"], "íŒŒí‚¤ìŠ¤íƒ„": ["ê¹€ì‹ ë¯¸"],
      "ë™í‹°ëª¨ë¥´": ["ê¹€ì˜¥ê²¸"], "ë§ë ˆì´ì‹œì•„": ["ê¹€ì¬ì„ "], "ë‰´ì§ˆëœë“œ": ["ë¥˜ìˆ™"],
      "í˜¸ì£¼": ["ìµœë²”ìš±", "ì´ë³‘ê´€"], "ì´ìŠ¤ë¼ì—˜": ["ê¹€ì •í™˜", "ì•ˆìƒê·¼"],
      "ë…ì¼": ["ê¹€ë™ìš±", "ì •ê´‘ì€", "ì¡°ì„±í˜¸", "ê¹€ê¸°ì²œ", "ê°•ë¯¼ì˜"],
      "í—ê°€ë¦¬": ["ê¹€ì„ êµ¬", "ê¹€ë‹¤ì†œ", "ìµœì¢…ê´€"], "ë¶ˆê°€ë¦¬ì•„": ["ê¹€ì˜ì¤‘"],
      "ë¶€ë¥´í‚¤ë‚˜íŒŒì†Œ": ["ìœ¤ì˜êµ­"], "ì¼€ëƒ": ["ìµœì„±ìš±"], "ëª¨ë¦¬íƒ€ë‹ˆ": ["ì‹¬ì¬ì›"],
      "ë¯¸êµ­": ["ì¥í˜¸ì¤€"], "ì¿ ë°”": ["ì„ìˆœì‹¬"]
    };

    // êµ­ê°€ë³„ ìœ„ë„/ê²½ë„ ì •ë³´
    const latlngs = {
      "ì¼ë³¸": [36.2048, 138.2529], "ì¤‘êµ­": [35.8617, 104.1954], "ëŒ€ë§Œ": [23.6978, 120.9605], "ëª½ê³¨": [46.8625, 103.8467],
      "í•„ë¦¬í•€": [12.8797, 121.7740], "ë¯¸ì–€ë§ˆ": [21.9162, 95.9560], "íƒœêµ­": [15.8700, 100.9925], "ìº„ë³´ë””ì•„": [12.5657, 104.9910],
      "ë„¤íŒ”": [28.3949, 84.1240], "ë¼ì˜¤ìŠ¤": [19.8563, 102.4955], "ì¸ë„": [20.5937, 78.9629], "ì¸ë„ë„¤ì‹œì•„": [-0.7893, 113.9213],
      "íŒŒí‚¤ìŠ¤íƒ„": [30.3753, 69.3451], "ë™í‹°ëª¨ë¥´": [-8.8742, 125.7275], "ë§ë ˆì´ì‹œì•„": [4.2105, 101.9758],
      "ë‰´ì§ˆëœë“œ": [-40.9006, 174.8860], "í˜¸ì£¼": [-25.2744, 133.7751], "ì´ìŠ¤ë¼ì—˜": [31.0461, 34.8516],
      "ë…ì¼": [51.1657, 10.4515], "í—ê°€ë¦¬": [47.1625, 19.5033], "ë¶ˆê°€ë¦¬ì•„": [42.7339, 25.4858],
      "ë¶€ë¥´í‚¤ë‚˜íŒŒì†Œ": [12.2383, -1.5616], "ì¼€ëƒ": [-0.0236, 37.9062], "ëª¨ë¦¬íƒ€ë‹ˆ": [21.0079, -10.9408],
      "ë¯¸êµ­": [37.0902, -95.7129], "ì¿ ë°”": [21.5218, -77.7812]
    };

    const detailPopup = document.getElementById('detailPopup');

    // ì„ êµì‚¬ ìƒì„¸ ì •ë³´ íŒì—… í‘œì‹œ í•¨ìˆ˜
    function showDetail(name, latlng) {
      const point = map.latLngToContainerPoint(latlng);
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;

      let left = point.x + 20;
      let top = point.y - 20;

      // í™”ë©´ ì¤‘ì•™ 70% ì´ë‚´ë¡œ íŒì—… ìœ„ì¹˜ ë³´ì •
      if (left < windowWidth * 0.15) left = windowWidth * 0.15;
      if (left > windowWidth * 0.85 - 300) left = windowWidth * 0.85 - 300;
      if (top < windowHeight * 0.15) top = windowHeight * 0.15;
      if (top > windowHeight * 0.85 - 200) top = windowHeight * 0.85 - 200;

      detailPopup.style.left = `${left}px`;
      detailPopup.style.top = `${top}px`;
      detailPopup.innerHTML = `
        <div class="close-btn" onclick="closeDetail()">âœ–</div>
        <img src="https://via.placeholder.com/300x180.png?text=${name}" alt="${name}">
        <h3>${name}</h3>
        <p><strong>íŒŒì†¡ë…„ë„:</strong> 2020ë…„</p>
        <p><strong>ì£¼ìš”ì‚¬ì—­:</strong> êµìœ¡, ë³µìŒì „ë„</p>
        <p><strong>ê¸°ë„ì œëª©:</strong> í˜„ì§€ ì •ì°©ê³¼ ê±´ê°•</p>
      `;
      detailPopup.style.display = 'block';

      // ì§€ë„ ì´ë™: ì¤‘ì•™ 70% ì´ë‚´ë¡œ ì„ êµì‚¬ ìœ„ì¹˜ ë³´ì •í•˜ì—¬ ì´ë™
      const bounds = map.getBounds();
      const paddingLat = (bounds.getNorth() - bounds.getSouth()) * 0.15;
      const paddingLng = (bounds.getEast() - bounds.getWest()) * 0.15;
      const adjustedLat = Math.min(Math.max(latlng[0], bounds.getSouth() + paddingLat), bounds.getNorth() - paddingLat);
      const adjustedLng = Math.min(Math.max(latlng[1], bounds.getWest() + paddingLng), bounds.getEast() - paddingLng);
      map.panTo([adjustedLat, adjustedLng]);
    }

    // ìƒì„¸ íŒì—… ë‹«ê¸° í•¨ìˆ˜
    function closeDetail() {
      detailPopup.style.display = 'none';
    }

    // ë§ˆì»¤ ë° íŒì—… ìƒì„±
    const markers = Object.entries(missionaryData).map(([country, missionaries]) => {
      const [lat, lng] = latlngs[country] || [0, 0];
      const flag = countryFlags[country] ? `<img class='flag-icon' src='https://flagcdn.com/w40/${countryFlags[country]}.png'>` : "";
      const popupContent = `${flag}<b>${country}</b><br>` +
        missionaries.map(name => `<div class='popup-list' onclick='showDetail(\"${name}\", [${lat}, ${lng}])'>${name}</div>`).join("");
      const marker = L.marker([lat, lng]).addTo(map);
      marker.bindPopup(popupContent);
      return marker;
    });

    // ìˆœí™˜ íŒì—… ë¡œì§
    let currentIndex = 0;
    let pause = false;

    document.addEventListener("mouseover", e => {
      if (e.target.closest(".leaflet-popup") || e.target.closest(".popup-list")) pause = true;
    });
    document.addEventListener("mouseout", e => {
      if (!e.relatedTarget || (!e.relatedTarget.closest(".leaflet-popup") && !e.relatedTarget.closest(".popup-list"))) pause = false;
    });

    // 3ì´ˆë§ˆë‹¤ ìˆœì°¨ì ìœ¼ë¡œ ë§ˆì»¤ íŒì—… í‘œì‹œ
    setInterval(() => {
      if (!pause) {
        markers.forEach(m => m.closePopup());
        markers[currentIndex].openPopup();
        currentIndex = (currentIndex + 1) % markers.length;
      }
    }, 3000);
  </script>
</body>
</html>

